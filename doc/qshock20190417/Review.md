形式的仕様記述やってみた感想
============================

感想
-----

* CSPやTLA+で仕様書いてみたけど、期待していたことのうち成功したものも失敗したものあった。
    * 間違いや考慮漏れにより気づきやすくなる => YesでもNoでもある
    * コンパクトに記述出来て全容の把握が更に容易になる => Yes
    * 記述時間は慣れていれば早く済む => 自然言語と比べるならYes
    * 曖昧さがなくなり、相互理解が高まる => ???(見る人が限られすぎ)

* その他の気づき
    * ○: 何を作るべきか、ソレがバグかどうかすぐに判断出来た
    * ○: 実装時の手戻りを事前に防げたと感じる時が何度かあった(人間の想像力や注意力の欠如をある程度は補強してくれる)
    * ○: 割り込みや短くない間プロジェクトから離れた時のコンテキスト復帰コスト低減した
    * ○: 網羅的かつ機械的なテストケース作成が出来た
    * ○: モデルと一緒にテストケースも書いて検査出来る（どんなイベント列を受理するかだけでなく、どんなイベントは拒否するべきかも書かなければならない）
    * ×: 検査器がないと見逃しは出る
    * ×: 素直にモデリングすると組み合わせ爆発して十分な検査が出来ない
    * ×: そもそも最初の見積りの材料として仕様を使う機会がなかった
    * ×: 実装時やテスト時に仕様の問題(漏れ、曖昧さ、間違い)に気付いて変更や手戻りが発生した
    * ×: チーム全員に浸透させることが出来なかった
    * ？: 自分にピッタリの完璧なツールなんてない。自分で作るのもコスト大きい
    * ×: シミュレーション機能、可視化工夫しないと見落とす

形式的仕様記述の難しさ
------------------------

* モデルしか見なくなって、モデルに表れない要素は見落としやすい
    * 非機能要求が漏れる(結果的に耐久や安定性や動作環境関係の評価やテストが後回しになる)
    * 異常系のイベントが漏れる(数のオーバーフロー、計算・記憶・通信リソースの枯渇、通信やライブラリやハードの異常)

* モデルに書いてある問題に気付けない
    * 使ってみて初めて「危ない」とか「使いづらい」とか「設定に使う入力値どうやって決めるの？」とかに気づくことが多い

* 例え形式的に書いても、ソレが自分が表現したいモノと一致しているとは限らない(プログラムに対するバグと同じ)
    * モデルやそれに対するテスト(検査やvalidation)の正確さや漏れのなさの担保は開発者のレビューだけ(見落とす)
    * 不変条件/事前条件/事後条件が緩かったり不適切だったりすることもチラホラあった

* システムのモデリングは難しい
    * 何を捨象し、何を抽象すればいいのか？
        * 目的の1つはイメージを正しく伝えること
        * そもそも自分が欲しているもののイメージが曖昧
        * 頭の中におさまる程度の複雑さ(1000〜2000行程度??)
        * 手間を惜しんで記述しやすいように近似してしたり、表現することを諦めたりすると、後々に問題を引き起こすこともあった(例えば、ある要素Aとある要素Bの間には関係があるのに、それが表現されていなくて危険な機能を実装してしまったとか)
        * ゲームを作ってるような難しさ(楽しい)
    * Open vs Close
        * システムの境界がソフトの境界と一致する訳ではない(そもそもシステムという言葉が曖昧でどこを指すのか人によって違う)
        * 電気やハードの状態や環境まで表現するべき場合もある
        * 前提条件を満たす為や異常系をハンドリングする為に運用ルールにまで踏み込むことが必要な場合もあるかもしれない
        * 顧客の抱える問題そのものがモデルに入っているとある程度validationも出来る
    * 時間の扱い方
        * そもそも時刻を直接扱わないように記述して非機能で書く(テストケースの記述はコメントを使ってモデルで表現出来ない点について述べる)
        * 明示的にdeltaを刻んだり、各イベントに時刻を埋め込んで振る舞いを書く(刻み方には注意しないと状態爆発する)
        * 絶対時刻 vs 相対時刻
    * 手続き的に振る舞いを書くと実装とあんまり変わらずダブルメンテ状態になる
        * 振る舞い(状態のリスト)としてどうなっていけないかを記述することはなかな大変。
        * 手続き的に書くほうが簡単に思えてしまう場合が多々ある。(Alloyとかはそれを許してくれない)
    * 検査ツールの性能や制約がモデリングに影響する
        * デフォルトだと 1000000 個以上の要素を持つ集合は作れない(Intとかはよく分からない)
        * 不変条件や要素間の関係をうまく使うと多少組み合わせは減る(Context図とか書きつつ)
        * 後は網羅諦めて運任せsimulationモードとか


最近思うこと
------------

* 情報の整理や推敲の為に必要だと感じてモデルを書いているが、性格的にキチッとしていて頭の中にZ3ソルバ詰んでる人ならわざわざモデルなんて書かなくても良いのでは？


実際にTLA+書いてみたメンバの意見
---------

* (AlloyやCSPの知識があったので)学習コストは大きいという印象はない。
* 仕様を考える普段の思考が手続き的なので、CSPMのほうが書きやすいと感じる。
* (おそらく状態爆発が原因で)モデル検査が現実的でないのはツラい。正しく記述できている自信がないから。
* ただ、TLA+で仕様を書いて、それを(将来の自分を含む)誰かに伝えるのが目的であれば、トレース(イベントの発生順序)のAccept/Rejectだけチェックできれば十分だろうと感じる。
* 実装が仕様を満たしているかとても確認しやすい。日本語の仕様書でよくある曖昧さがないのがうれしい。
* 日本語で書かれた仕様書は読みたくならないが、TLA+で書かれた仕様書は読みたくなる。興味や好奇心をそそられる。


