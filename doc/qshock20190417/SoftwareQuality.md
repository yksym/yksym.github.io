
失敗談
--------

過去色々な会社で関わったプロジェクトで作ったシステムの品質について悩まされたことは勿論ある

* 完成したと思った機能に問題があることが発覚し、大幅な手戻りが発生
* 顧客と合意した受け入れテストにパスしたが、クレームが発生し、終わったと思ったプロジェクトがゾンビのように不意に襲いかかる

品質とは？
-------

品質の定義

* SWEBOK Wiki "品質とはシステムが特定環境下においてステークホルダー達からの明示的な要求や暗黙的な期待に応えられる程度"(意訳)[1]
* バグ、いわゆるIEEE 982.1-2005 の defect（欠陥）の定義は、"設計者の認識の有無にかかわらず、すべての成果物において要件定義の誤り、仕様設計の誤り、プログラミングの誤り、システム構築の誤りなどにより「期待される結果」と乖離があるために、何かしらの対策・対応が必要と考えられる現象またはその原因。"[2]
* 要求にスケジュールや金額面も含まれることを加味すると、そのプロジェクトが成功したかどうか、にかなり近い

どんな失敗があったか？
-----------------------

上の定義を見ながら、所属組織関係なく過去にどんな失敗が発生したか覚えている範囲で振り返ってみると少なくとも下の6種類がある。

1. 環境の定義に失敗
    * 実験施設ではうまくいくけど顧客が使いたかった場所では期待した動作にならない
    * ネットワーク特性(安定度やら帯域やら)、温度、OS、マシンスペック、電源スペック、依存ライブラリ、周辺機器の違いで期待した動作にならない
2. ステークホルダーの定義に失敗
    * 開発者、発注者以外が開発開始時点で存在せず、仮定に仮定を重ねてしまう（保守運用のオペレーター、エンドユーザー、販売、法務関係等)
3. 明示的な要求を満たすことに失敗
    * 「プロトタイピングだから正常系だけ動けば良い」という顧客の言葉を誤解して、高い信頼性を求められていることに気付けなかった
    * 顧客が提示した 受け入れ試験 にさえクリア出来れば良いという誤解(当たり前だけど実運用とは異なる環境であることが多い)
    * 妥当性のない仕様の記述をしていてその発覚が出来なかった
    * 設計・実装時の不具合埋め込み及びその発覚が出来なかった
4. 暗黙的な期待の抽出に失敗
    * 作ったシステムは顧客が抱える問題を上手く解けていなかった（十分な信頼性や正確性がなかったり、使い辛かったり)
    * 開発側が制約やリスクについて正しく伝えることにが出来なかった
    * ドメイン知識が不足していて開発側が思い込んでいた事前条件が崩れたり、必要な不変条件や事後条件が抜けていたりしていて手戻りが発生
6. 動的に変化する要望/仕様やステークホルダを管理することに失敗
    * 適切な仕様管理、プロジェクト管理プロセスが導入されておらず、いつの間にか各ステークホルダーが異なるスケジュール、異なる仕様を見ている
7. 時間切れ
    * 取り組む優先順位を間違えて、期限までに十分な価値を提供出来ない
    * 不確実性や工数の都合もあって十分な分析・検討が受注の前に出来ず、見積りがブレる
    * 機能を過剰にリッチにしてしまうとか、価値の高い機能から実装していないとか
    * 選定や発注の失敗(品質が悪いモノが来たり、納期が遅れたり）

失敗の原因は？
----------

沢山あるが、一番頻度と深刻度が高いものは3つ。

* (a) 開発者が解くべき問題について十分に理解していない
    * 仕様を記述しても開発者はその妥当性が判断出来ない
    * 取り組む優先順位を間違える

* (b) 品質を測ることが出来ていない
    * 品質の評価方法はスプリントレビュー時の顧客からのフィードバックに依存している
        * レビュー参加者だけで適切に評価出来るとも限らない
        * 開発環境での短時間の動作の様子はチャンピョンデータみたいなもの
        * 記述された仕様を見ても、顧客はその不十分さや曖昧さに気付けない
    * 不具合が出てくるまで品質の悪さが認識出来ない(不十分なテストや未評価の状態を品質良好と錯覚してしまう)

* (c) 非機能要求への軽視や誤解
    * 機能実装を優先して非機能テストやバグ修正を後回しにしてしまう
        * 非機能要求テストは別ストーリーになってしまっていて、バックログの下の方にいたりする
        * 規模が膨らむ程、ビッグバンの危険やバグ修正コストは高くなる
    * ユーザーストーリーや仕様に非機能面の記述がなかったり曖昧だったり
        * 非機能試験を通さずに、機能実装を完了したと錯覚してしまう(非機能という名前が錯覚の原因な気がする)
        * 開発の途中だから、後で別途テスト・評価するから、という甘えがある
    * validationがシステムが出来上がってから行われ、仕様の間違いに気づく
        * どう使われるか頭の中でイメージはするが、物理応答や可視化されたモノがないと問題やリスクを見落とす(逆に実物を見ると「危機感」が働いて色々見える・・・)


何から手をつける？
----------

* (a) 問題について記述する
    * SRS/SyRSといった要求仕様書([3])に自然言語で書く
        * エレベーターピッチ程度に留めず、各機能がどういう価値を誰に提供するものなのか説明出来ると良いのかもしれない(時間やお金の節約、リスクの回避)
    * 問題のモデルを作る
        * 物事を理解する一番の方法は作ること(情報の整理や推敲の点で大変効果がある)
        * コンテキスト図[4]が参考になる
        * Open Modele, Model Validation とか

* (b) 品質評価方法を極力具体的・限定的に定義して仕様や制約として取り込む
    * 書かない or 曖昧に書くより、限定した方が誤解が少なく、フィードバックも得やすいし、テストしやすい
    * とりあえず、プロトタイピングだから後で決めるはやめる。分からなければ、仮説を立てて決定する。ただし検証を可能な限り早くスケジューリングする。
    * 人間は欲しいモノの十分条件は分からなくても、必要条件を見つけることは得意(何が欲しいかうまく説明出来なくてもソレが欲しいかどうかは判定出来たりする)
    * Tests as Documentation, Specification by Example とか

* (c) 品質評価作業のスケジューリングを見直す
    * 機能実装に回帰テストに非機能要求に対するテストも盛り込む
    * validationが各タイミングで行えるようにモックとシナリオは必要(絵や模型を見ながら、物理システム担当者とシステム担当者とユーザー担当者でロールプレイしてみる）


参考文献
-------

* [1] [SWEBOK](http://swebokwiki.org/)
* [2] [組込みソフトウェア開発における品質向上の勧め バグ管理手法編](https://www.ipa.go.jp/files/000027629.pdf)
* [3] [ソフトウェア要求](https://www.amazon.co.jp/ソフトウェア要求-第3版-Karl-Wiegers、Joy-Beatty/dp/4822298396)
* [4] [プロブレムフレーム ソフトウェア開発問題の分析と構造化](https://www.amazon.co.jp/プロブレムフレーム-ソフトウェア開発問題の分析と構造化-Architects-ソフトウェア開発の課題3-Archiveソフトウェア開発の課題/dp/4798108782)


